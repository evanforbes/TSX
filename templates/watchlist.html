<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Watchlist - Auction House</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000; color: #fff;
            padding-top: env(safe-area-inset-top);
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
        }
        a { color: inherit; text-decoration: none; }
        .header {
            background: #000; padding: 16px 20px;
            display: flex; align-items: center; gap: 16px;
            border-bottom: 1px solid #222; position: sticky; top: 0;
        }
        .back-btn { color: #0A84FF; font-size: 17px; }
        .header h1 { font-size: 20px; font-weight: 700; }
        .card {
            background: #111; margin: 16px; border-radius: 16px; overflow: hidden;
        }
        .stock-card {
            padding: 16px 20px; border-bottom: 1px solid #1c1c1c;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; touch-action: manipulation;
        }
        .stock-card:last-child { border-bottom: none; }
        .stock-card:active { background: #1a1a1a; }
        .stock-info { flex: 1; }
        .stock-symbol { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
        .stock-meta { font-size: 13px; color: #8E8E93; }
        .stock-meta .sector { color: #0A84FF; }
        .stock-price { text-align: right; }
        .stock-price .price { font-size: 17px; font-weight: 600; }
        .stock-price .change { font-size: 12px; margin-top: 2px; }
        .stock-price .change.up { color: #00C805; }
        .stock-price .change.down { color: #FF3B30; }
        .signal-tag {
            display: inline-block; padding: 3px 8px; border-radius: 6px;
            font-size: 11px; font-weight: 500; margin-right: 6px; margin-top: 6px;
        }
        .signal-tag.buy { background: #00C805; color: #000; }
        .signal-tag.sell { background: #FF3B30; color: #000; }
        .signal-tag.gold { background: #FFD60A; color: #000; }
        .signal-tag.silver { background: #98989D; color: #000; }
        .empty-state {
            text-align: center; padding: 60px 20px; color: #666;
        }
        .empty-state .title { font-size: 18px; font-weight: 600; color: #fff; margin-bottom: 8px; }
        .remove-btn {
            background: #FF3B30; color: #fff; border: none;
            padding: 8px 16px; border-radius: 8px; font-size: 14px;
            cursor: pointer; touch-action: manipulation;
        }
        .info-row {
            display: flex; gap: 12px; margin-top: 8px; flex-wrap: wrap;
        }
        .info-badge {
            font-size: 11px; padding: 4px 8px; border-radius: 6px;
            background: #1c1c1e; color: #8E8E93;
        }
        .info-badge.dividend { color: #00C805; }
        .info-badge.earnings { color: #FF9F0A; }
        .info-badge.high-vol { color: #FF3B30; }
    </style>
</head>
<body>
    <div class="header">
        <a href="/" class="back-btn">‚Üê Back</a>
        <h1>Watchlist</h1>
    </div>

    {% if stocks %}
    <div class="card">
        {% for stock in stocks %}
        <div class="stock-card" onclick="window.location='/stock/{{ stock.symbol }}'">
            <div class="stock-info">
                <div class="stock-symbol">{{ stock.symbol }}.TO</div>
                <div class="stock-meta">
                    {% if stock.info.sector %}
                    <span class="sector">{{ stock.info.sector }}</span>
                    {% endif %}
                </div>
                <div class="info-row">
                    {% if stock.tier.tier_buy == 'GOLD' %}
                    <span class="signal-tag gold">Gold Buy</span>
                    {% elif stock.tier.tier_sell == 'GOLD' %}
                    <span class="signal-tag gold">Gold Sell</span>
                    {% elif stock.tier.tier_buy == 'SILVER' %}
                    <span class="signal-tag silver">Silver Buy</span>
                    {% elif stock.tier.tier_sell == 'SILVER' %}
                    <span class="signal-tag silver">Silver Sell</span>
                    {% endif %}
                    {% for indicator, signal, desc in stock.signals %}
                    <span class="signal-tag {{ 'buy' if signal in ['BUY', 'STRONG_BUY'] else 'sell' }}">{{ indicator }}</span>
                    {% endfor %}
                </div>
                <div class="info-row">
                    {% if stock.info.dividend_yield %}
                    <span class="info-badge dividend">Div: {{ "%.2f"|format(stock.info.dividend_yield) }}%</span>
                    {% endif %}
                    {% if stock.info.earnings_date %}
                    <span class="info-badge earnings">Earnings: {{ stock.info.earnings_date }}</span>
                    {% endif %}
                    {% if stock.info.volume_ratio and stock.info.volume_ratio > 1.5 %}
                    <span class="info-badge high-vol">Vol: {{ "%.1f"|format(stock.info.volume_ratio) }}x avg</span>
                    {% endif %}
                </div>
            </div>
            <div class="stock-price">
                <div class="price">${{ "%.2f"|format(stock.price) }}</div>
                {% if stock.info.week_52_pct is not none %}
                <div class="change {{ 'up' if stock.info.week_52_pct > 50 else 'down' }}">
                    52W: {{ "%.0f"|format(stock.info.week_52_pct) }}%
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="title">No stocks in watchlist</div>
        <div>Add stocks from the detail page</div>
    </div>
    {% endif %}
</body>
</html>
